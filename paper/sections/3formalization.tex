\section{Formalization}
\label{sec:formalization}

\subsection{Atomic Swap}

(We follow the notion in ``Perun: Virtual Payment Hubs over Cryptocurrencies'')

Alice hopes to buy $x_2$ $Coin_2$ on blockchain $BC_2$ with $x_1$ $Coin_1$ on blockchain $BC_1$.
She initiates an atomic swap, and Bob participates in the atomic swap.

The Atomic Swap protocol follows the steps below:

\begin{enumerate}
    \item Setup: Alice and Bob create addresses on both blockchains.
    \item Initiate: Alice initiates the Atomic Swap by publishing a contract transaction on $BC_1$.
    \item Participate: Bob participates in the Atomic Swap by publishing a contract transaction on $BC_2$.
    \item Redeem: Alice redeems $x_2$ $Coin_2$ and Bob redeems $x_1$ $Coin_1$. Alice should redeem earlier than Bob.
    \item Refund: If Alice or Bob is unsatisfied with the Atomic Swap, he/she can get his/her money back after the timelock of the contract transaction.
\end{enumerate}

\paragraph{Setup}
takes the security parameter $k$,
and returns the address on two blockchains for Alice and Bob $\beta_{A, 1}$, $\beta_{A, 2}$, $\beta_{B, 1}$, $\beta_{B, 2}$.

\paragraph{Initiate}
takes $\beta_{B, 1}$ and $x_1$,
and returns the preimage $s$, the preimage hash $h$, the contract script $\mathcal{C}_1$, the contract transaction $tx_{\mathcal{C}, 1}$, the refund script $\mathcal{R}_1$, and the refund transaction $tx_{\mathcal{R}, 1}$.
The preimage $s$ is a random string generated by Alice. At this stage, $s$ is only known to Alice.
The preimage hash $h = H(s)$, where $H$ is a cryptographic hash function.  $h$ is published when Initiate.
The contract script $\mathcal{C}_1$ is that ``Alice pays $x_1$ $Coin_1$ from $\beta_{A, 1}$ to $\beta_{B, 1}$ if Bob can provide $s$ within a timelock $\Delta_1$. After the time of $\Delta_1$, Alice can refund the money - get $x_1$ $Coin_1$ back.''
The contract script is published as a transaction $tx_{\mathcal{C}, 1}$ on $BC_1$ when Initiate.
The refund script $\mathcal{R}_1$ is that ``Alice pays $x_1$ $Coin_1$ from $\beta_{A, 1}$ to her another address.'' This is to ensure $x_1$ $Coin_1$ can no longer be redeemed by others. Alice can do this only after the timelock $\Delta_1$.
The refund is done by publishing $\mathcal{R}_1$ as a transaction $tx_{\mathcal{R}, 1}$ on $BC_1$ if Alice can and decide to refund.

\paragraph{Participate}
takes $\beta_{A, 2}$, $x_2$ and $h$,
and returns the contract script $\mathcal{C}_2$, the contract transaction $tx_{\mathcal{C}, 2}$, the refund script $\mathcal{R}_2$, and the refund transaction $tx_{\mathcal{R}, 2}$.
The contract script $\mathcal{C}_2$ is that ``Bob pays $x_2$ $Coin_2$ from $\beta_{B, 2}$ to $\beta_{A, 2}$ if Alice can provide $s$ within a timelock $\Delta_2$. Here $\Delta_2$ should expire earlier than $\Delta_1$. After the time of $\Delta_2$, Bob can refund the money - get $x_2$ $Coin_2$ back.''
The contract script is published as a transaction $tx_{\mathcal{C}, 2}$ on $BC_2$ when Initiate.
The refund script $\mathcal{R}_2$ is that ``Bob pays $x_2$ $Coin_2$ from $\beta_{B, 2}$ to his another address.'' This is to ensure $x_2$ $Coin_2$ can no longer be redeemed by others. Bob can do this only after the timelock $\Delta_2$.
The refund is done by publishing $\mathcal{R}_2$ as a transaction $tx_{\mathcal{R}, 2}$ on $BC_2$ if Bob can and decide to refund.

\paragraph{Redeem}
takes $s$,
and returns $\mathcal{V} \in \{true, false\}$ indicating if the redemption is successful or not.
The redemption can be performed by both parties, and Alice should redeem earlier than Bob.
As Alice knows $s$, she can redeem $x_2$ $Coin_2$ - pay $x_2$ $Coin_2$ in $\beta{A, 2}$ to her another address by attaching $s$ in this transaction.
After Alice redeems $x_2$ $Coin_2$, $s$ is published, so that Bob can redeem $x_1$ $Coin_1$, similarly.

\paragraph{Refund}
takes no parameters and returns the $\mathcal{V} \in \{true, false\}$ indicating if the refund is successful or not.
Alice and Bob can perform the refund by publishing $tx_{\mathcal{R}, 1}$ and $tx_{\mathcal{R}, 2}$ after the timelock $\Delta_1$ and $\Delta
_2$, respectively.










\subsection{American Option}
